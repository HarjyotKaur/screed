.. vim: set filetype=rst

=====================
Release Documentation
=====================

Notes on this document
======================
This is the procedure for cutting a new release of screed. It has been adapted
from the release documentation for the khmer project, found at
http://khmer.readthedocs.org/en/v1.1/release.html.

Getting Started
===============

 #. Start with a clean checkout:
    cd `mktemp -d`
    git clone git@github.com:ged-lab/screed.git
    cd screed

 #. Install/update versioneer:
    pip install versioneer
    versioneer-installer

 #. Review the git logs since the previous release and that ChangeLog reflects
the major changes

 #. Review the issue list for any existing bugs that won't be fixed in the
release and ensure they're documented in ``doc/known-issues.txt``

 #. Verify that the build is clean: https://travis-ci.org/ged-lab/screed/

 #. Set the new version number and release candidate::
      new_version=1.1
      rc=rc3
    Tag the release candidate with the new version prefixed by the letter 'v'::
      git tag v1.1-rc3
      git push --tags git@github.com:ged-lab/screed.git
 #. Test the release candidate (note: you will have to change the version
     number and RC number. You will also have to make sure you have nose
     installed, a la ``pip install nose``)::
     cd ..
     virtualenv testenv1
     virtualenv testenv2
     virtualenv testenv3

     # first we test the tag
     cd testenv1
     source bin/activate
     pip install nose
     # be sure to fill i nthe right version and release candidate.
     git clone --depth 1 --branch v1.0-rc1 https://github.com/ged-lab/screed.git
     cd screed
     make install
     nosetests screed --attr '!known_failing'
     make test
     get_version.py # double-check version number

     # Test via pip
     cd ../../testenv2
     source bin/activate
     pip install nose
     pip install -U setuptools==3.4.1
     # be sure to fill in the right version and release candidate
     pip install -e git+https://github.com/ged-lab/screed.git@v${new_version}-${rc}#egg=screed
     cd src/khmer

 #. Publish the new release on the testing PyPI server. You will need to
     change your PyPI credentials as documented here:
     https://wiki.python.org/moin/TestPyPI. You may need to re-register::

        python setup.py register --repository test

    Now, upload the new release::
        python setup.py sdist upload -r test
    
    Test the PyPI release in a new virtualenv::

        cd ../../testenv4
        source bin/activate
        pip install -U setuptools==3.4.1
        pip install screed nose
        pip install -i https://testpypi.python.org/pypi --pre --no-clean screed
        nosetests screed --attr '!known_failing'
        python get_version.py
        cd build/khmer
        ./setup.py nosetests
 #. Do any final testing (acceptance tests, etc.)
     Note that the acceptance tests for screed are to run the khmer automated
     tests with the new version of screed installed and then to run the khmer
     acceptance tests.
 
 #. Make sure any release notes are merged into doc/release-notes/.
